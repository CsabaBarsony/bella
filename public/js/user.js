(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var cs = require('../../helpers/cs');

var User = React.createClass({
	displayName: 'User',

	getInitialState: function getInitialState() {
		return {
			status: 'init',
			opened: false,
			errorMessage: ''
		};
	},
	componentDidMount: function componentDidMount() {
		var _this = this;

		if (cs.cookie('user_id', document.cookie) && cs.cookie('token', document.cookie)) {
			cs.get('userstatus', function (response) {
				if (response.status === 'guest') {
					_this.setState({ status: 'guest' });
					bella.event.emit('userStatusChange', { status: response.status }, _this);
				} else if (response.status === 'loggedIn') {
					bella.event.emit('userStatusChange', { status: response.status }, _this);
					_this.setState({
						status: 'loggedIn',
						user: response.data
					});
				}
			});
		} else {
			this.setState({ status: 'guest' });
		}
	},
	render: function render() {
		if (this.state.status === 'init') {
			return React.createElement(
				'div',
				null,
				'initializing...'
			);
		} else if (this.state.status === 'guest') {
			var errorMessage = this.state.errorMessage ? React.createElement(
				'div',
				null,
				this.state.errorMessage
			) : null;

			var popup = this.state.opened ? React.createElement(
				'div',
				{ className: 'bc-user-popup' },
				errorMessage,
				React.createElement('input', { type: 'text', ref: 'name', defaultValue: 'a' }),
				React.createElement('br', null),
				React.createElement('input', { type: 'text', ref: 'password', defaultValue: '1' }),
				React.createElement('br', null),
				React.createElement(
					'button',
					{ onClick: this.login },
					'Login'
				)
			) : null;

			return React.createElement(
				'div',
				{ className: 'bc-user' },
				React.createElement(
					'a',
					{ href: '', onClick: this.click },
					'user'
				),
				popup
			);
		} else if (this.state.status === 'loggedIn') {
			var popup = this.state.opened ? React.createElement(
				'div',
				{ className: 'bc-user-popup' },
				React.createElement(
					'a',
					{ href: '', onClick: this.logout },
					'logout'
				)
			) : null;

			return React.createElement(
				'div',
				{ className: 'bc-user' },
				React.createElement(
					'a',
					{ href: '', onClick: this.click },
					this.state.user.name
				),
				popup
			);
		}
	},
	click: function click(e) {
		e.preventDefault();
		this.setState({ opened: !this.state.opened });
	},
	login: function login() {
		var _this2 = this;

		cs.post('login', {
			username: this.refs.name.value,
			password: this.refs.password.value
		}, function (response) {
			if (response.status === 'loggedIn') {
				bella.event.emit('userStatusChange', { status: response.status }, _this2);
				_this2.setState({
					errorMessage: '',
					status: 'loggedIn',
					user: response.data,
					opened: false
				});
			} else if (response.status === 'guest') {
				bella.event.emit('userStatusChange', { status: response.status }, _this2);
				_this2.setState({ errorMessage: response.errorMessage });
			}
		});
	},
	logout: function logout(e) {
		var _this3 = this;

		e.preventDefault();
		cs.get('logout', function (response) {
			if (response.status === 'guest') {
				bella.event.emit('userStatusChange', { status: response.status }, _this3);
				_this3.setState({
					status: 'guest',
					username: '',
					opened: false
				});
			}
		});
	}
});

ReactDOM.render(React.createElement(User, null), document.getElementById('bc-user-container'));

},{"../../helpers/cs":2}],2:[function(require,module,exports){
'use strict';

var cs = {
	log: function log(text) {
		console.log(text);
	},
	get: function get(url, success) {
		var xhr = new XMLHttpRequest();

		xhr.onreadystatechange = function () {
			if (xhr.readyState === XMLHttpRequest.DONE) {
				if (xhr.status === 200) {
					success(JSON.parse(xhr.response));
				} else {
					console.error('ajax get error');
				}
			}
		};
		xhr.open('GET', url);
		xhr.send();
	},
	post: function post(url, data, success) {
		var xhr = new XMLHttpRequest();

		xhr.onreadystatechange = function () {
			if (xhr.readyState === XMLHttpRequest.DONE) {
				if (xhr.status === 200) {
					success(JSON.parse(xhr.response));
				} else {
					console.error('ajax post error');
				}
			}
		};
		xhr.open('POST', url);
		xhr.setRequestHeader('Content-type', 'application/json');
		xhr.send(JSON.stringify(data));
	},
	cookie: function cookie(name, cookies) {
		var c = this.cookies(cookies);
		return c[name];
	},
	cookies: function cookies(_cookies) {
		var nameValues = _cookies.split('; ');
		var result = {};
		nameValues.forEach(function (item) {
			var i = item.split('=');
			result[i[0]] = i[1];
		});
		return result;
	},
	getQueryValue: function getQueryValue(queryString, name) {
		var arr = queryString.match(new RegExp(name + '=([^&]+)'));

		if (arr) {
			return arr[1];
		} else {
			return null;
		}
	}
};

var tests = [{
	id: 1,
	test: function test() {
		var cookies = {
			csati: 'majom',
			one: 'two'
		};

		var result = true;

		var c = cs.cookies('csati=majom; one=two');

		if (c.csati !== cookies.csati) result = false;

		return result;
	}
}, {
	id: 2,
	test: function test() {
		return 'bar' === cs.cookie('foo', 'foo=bar; te=majom');
	}
}, {
	id: 3,
	test: function test() {
		return '123' === cs.getQueryValue('?csati=majom&user_id=123&valami=semmi', 'user_id');
	}
}];

if (false) {
	var result = true;
	tests.forEach(function (test) {
		if (!test.test()) {
			console.error(test.id + '. test failed');
			result = false;
		}
	});
	if (result) {
		console.log('All tests succeeded!');
	}
}

module.exports = cs;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlc1xcYnJvd3NlcmlmeVxcbm9kZV9tb2R1bGVzXFxicm93c2VyLXBhY2tcXF9wcmVsdWRlLmpzIiwidXNlci5qcyIsImNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQzs7QUFFckMsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQzs7O0FBQzVCLGdCQUFlLEVBQUUsMkJBQVc7QUFDM0IsU0FBTztBQUNOLFNBQU0sRUFBRSxNQUFNO0FBQ2QsU0FBTSxFQUFFLEtBQUs7QUFDYixlQUFZLEVBQUUsRUFBRTtHQUNoQixDQUFBO0VBQ0Q7QUFDRCxrQkFBaUIsRUFBRSw2QkFBVzs7O0FBQzdCLE1BQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUNoRixLQUFFLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxVQUFDLFFBQVEsRUFBSztBQUNsQyxRQUFHLFFBQVEsQ0FBQyxNQUFNLEtBQUssT0FBTyxFQUFFO0FBQy9CLFdBQUssUUFBUSxDQUFDLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7QUFDbkMsVUFBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLE1BQU0sRUFBRSxRQUFPLENBQUM7S0FDeEUsTUFDSSxJQUFHLFFBQVEsQ0FBQyxNQUFNLEtBQUssVUFBVSxFQUFFO0FBQ3ZDLFVBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxNQUFNLEVBQUUsUUFBTyxDQUFDO0FBQ3hFLFdBQUssUUFBUSxDQUFDO0FBQ2IsWUFBTSxF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QUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDOztBQUUzQyxNQUFHLENBQUMsQ0FBQyxLQUFLLEtBQUssT0FBTyxDQUFDLEtBQUssRUFBRSxNQUFNLEdBQUcsS0FBSyxDQUFDOztBQUU3QyxTQUFPLE1BQU0sQ0FBQztFQUNkO0NBQ0QsRUFDRDtBQUNDLEdBQUUsRUFBRSxDQUFDO0FBQ0wsS0FBSSxFQUFFLGdCQUFXO0FBQ2hCLFNBQVEsS0FBSyxLQUFLLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLG1CQUFtQixDQUFDLENBQUU7RUFDekQ7Q0FDRCxFQUNEO0FBQ0MsR0FBRSxFQUFFLENBQUM7QUFDTCxLQUFJLEVBQUUsZ0JBQVc7QUFDaEIsU0FBTyxLQUFLLEtBQUssRUFBRSxDQUFDLGFBQWEsQ0FBQyx1Q0FBdUMsRUFBRSxTQUFTLENBQUMsQ0FBQztFQUN0RjtDQUNELENBQ0QsQ0FBQzs7QUFFRixJQUFHLEtBQUssRUFBRTtBQUNULEtBQUksTUFBTSxHQUFHLElBQUksQ0FBQztBQUNsQixNQUFLLENBQUMsT0FBTyxDQUFDLFVBQVMsSUFBSSxFQUFFO0FBQzVCLE1BQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQUU7QUFDaEIsVUFBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLGVBQWUsQ0FBQyxDQUFDO0FBQ3pDLFNBQU0sR0FBRyxLQUFLLENBQUM7R0FDZjtFQUNELENBQUMsQ0FBQztBQUNILEtBQUcsTUFBTSxFQUFFO0FBQ1YsU0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0VBQ3BDO0NBQ0Q7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIGNzID0gcmVxdWlyZSgnLi4vLi4vaGVscGVycy9jcycpO1xyXG5cclxudmFyIFVzZXIgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XHJcblx0Z2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdHN0YXR1czogJ2luaXQnLFxyXG5cdFx0XHRvcGVuZWQ6IGZhbHNlLFxyXG5cdFx0XHRlcnJvck1lc3NhZ2U6ICcnXHJcblx0XHR9XHJcblx0fSxcclxuXHRjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XHJcblx0XHRpZihjcy5jb29raWUoJ3VzZXJfaWQnLCBkb2N1bWVudC5jb29raWUpICYmIGNzLmNvb2tpZSgndG9rZW4nLCBkb2N1bWVudC5jb29raWUpKSB7XHJcblx0XHRcdGNzLmdldCgndXNlcnN0YXR1cycsIChyZXNwb25zZSkgPT4ge1xyXG5cdFx0XHRcdGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2d1ZXN0Jykge1xyXG5cdFx0XHRcdFx0dGhpcy5zZXRTdGF0ZSh7IHN0YXR1czogJ2d1ZXN0JyB9KTtcclxuXHRcdFx0XHRcdGJlbGxhLmV2ZW50LmVtaXQoJ3VzZXJTdGF0dXNDaGFuZ2UnLCB7IHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzIH0sIHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2xvZ2dlZEluJykge1xyXG5cdFx0XHRcdFx0YmVsbGEuZXZlbnQuZW1pdCgndXNlclN0YXR1c0NoYW5nZScsIHsgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMgfSwgdGhpcyk7XHJcblx0XHRcdFx0XHR0aGlzLnNldFN0YXRlKHtcclxuXHRcdFx0XHRcdFx0c3RhdHVzOiAnbG9nZ2VkSW4nLFxyXG5cdFx0XHRcdFx0XHR1c2VyOiByZXNwb25zZS5kYXRhXHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuc2V0U3RhdGUoeyBzdGF0dXM6ICdndWVzdCcgfSk7XHJcblx0XHR9XHJcblx0fSxcclxuXHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYodGhpcy5zdGF0ZS5zdGF0dXMgPT09ICdpbml0Jykge1xyXG5cdFx0XHRyZXR1cm4gKFxyXG5cdFx0XHRcdDxkaXY+aW5pdGlhbGl6aW5nLi4uPC9kaXY+XHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmKHRoaXMuc3RhdGUuc3RhdHVzID09PSAnZ3Vlc3QnKSB7XHJcblx0XHRcdHZhciBlcnJvck1lc3NhZ2UgPSB0aGlzLnN0YXRlLmVycm9yTWVzc2FnZSA/XHJcblx0XHRcdFx0KFxyXG5cdFx0XHRcdFx0PGRpdj57dGhpcy5zdGF0ZS5lcnJvck1lc3NhZ2V9PC9kaXY+XHJcblx0XHRcdFx0KSA6IG51bGw7XHJcblxyXG5cdFx0XHR2YXIgcG9wdXAgPSB0aGlzLnN0YXRlLm9wZW5lZCA/IChcclxuXHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cImJjLXVzZXItcG9wdXBcIj5cclxuXHRcdFx0XHRcdHtlcnJvck1lc3NhZ2V9XHJcblx0XHRcdFx0XHQ8aW5wdXQgdHlwZT1cInRleHRcIiByZWY9XCJuYW1lXCIgZGVmYXVsdFZhbHVlPVwiYVwiIC8+PGJyIC8+XHJcblx0XHRcdFx0XHQ8aW5wdXQgdHlwZT1cInRleHRcIiByZWY9XCJwYXNzd29yZFwiIGRlZmF1bHRWYWx1ZT1cIjFcIiAvPjxiciAvPlxyXG5cdFx0XHRcdFx0PGJ1dHRvbiBvbkNsaWNrPXt0aGlzLmxvZ2lufT5Mb2dpbjwvYnV0dG9uPlxyXG5cdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHQpIDogbnVsbDtcclxuXHJcblx0XHRcdHJldHVybiAoXHJcblx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJiYy11c2VyXCI+XHJcblx0XHRcdFx0XHQ8YSBocmVmPVwiXCIgb25DbGljaz17dGhpcy5jbGlja30+dXNlcjwvYT5cclxuXHRcdFx0XHRcdHtwb3B1cH1cclxuXHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0KTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYodGhpcy5zdGF0ZS5zdGF0dXMgPT09ICdsb2dnZWRJbicpIHtcclxuXHRcdFx0dmFyIHBvcHVwID0gdGhpcy5zdGF0ZS5vcGVuZWQgPyAoXHJcblx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJiYy11c2VyLXBvcHVwXCI+XHJcblx0XHRcdFx0XHQ8YSBocmVmPVwiXCIgb25DbGljaz17dGhpcy5sb2dvdXR9PmxvZ291dDwvYT5cclxuXHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0KSA6IG51bGw7XHJcblxyXG5cdFx0XHRyZXR1cm4gKFxyXG5cdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwiYmMtdXNlclwiPlxyXG5cdFx0XHRcdFx0PGEgaHJlZj1cIlwiIG9uQ2xpY2s9e3RoaXMuY2xpY2t9Pnt0aGlzLnN0YXRlLnVzZXIubmFtZX08L2E+XHJcblx0XHRcdFx0XHR7cG9wdXB9XHJcblx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHRjbGljazogZnVuY3Rpb24oZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0dGhpcy5zZXRTdGF0ZSh7IG9wZW5lZDogIXRoaXMuc3RhdGUub3BlbmVkIH0pO1xyXG5cdH0sXHJcblx0bG9naW46IGZ1bmN0aW9uKCkge1xyXG5cdFx0Y3MucG9zdCgnbG9naW4nLCB7XHJcblx0XHRcdHVzZXJuYW1lOiB0aGlzLnJlZnMubmFtZS52YWx1ZSxcclxuXHRcdFx0cGFzc3dvcmQ6IHRoaXMucmVmcy5wYXNzd29yZC52YWx1ZVxyXG5cdFx0fSwgKHJlc3BvbnNlKSA9PiB7XHJcblx0XHRcdGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2xvZ2dlZEluJykge1xyXG5cdFx0XHRcdGJlbGxhLmV2ZW50LmVtaXQoJ3VzZXJTdGF0dXNDaGFuZ2UnLCB7IHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzIH0sIHRoaXMpO1xyXG5cdFx0XHRcdHRoaXMuc2V0U3RhdGUoe1xyXG5cdFx0XHRcdFx0ZXJyb3JNZXNzYWdlOiAnJyxcclxuXHRcdFx0XHRcdHN0YXR1czogJ2xvZ2dlZEluJyxcclxuXHRcdFx0XHRcdHVzZXI6IHJlc3BvbnNlLmRhdGEsXHJcblx0XHRcdFx0XHRvcGVuZWQ6IGZhbHNlXHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZihyZXNwb25zZS5zdGF0dXMgPT09ICdndWVzdCcpIHtcclxuXHRcdFx0XHRiZWxsYS5ldmVudC5lbWl0KCd1c2VyU3RhdHVzQ2hhbmdlJywgeyBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyB9LCB0aGlzKTtcclxuXHRcdFx0XHR0aGlzLnNldFN0YXRlKHsgZXJyb3JNZXNzYWdlOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH0sXHJcblx0bG9nb3V0OiBmdW5jdGlvbihlKSB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRjcy5nZXQoJ2xvZ291dCcsIChyZXNwb25zZSkgPT4ge1xyXG5cdFx0XHRpZihyZXNwb25zZS5zdGF0dXMgPT09ICdndWVzdCcpIHtcclxuXHRcdFx0XHRiZWxsYS5ldmVudC5lbWl0KCd1c2VyU3RhdHVzQ2hhbmdlJywgeyBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyB9LCB0aGlzKTtcclxuXHRcdFx0XHR0aGlzLnNldFN0YXRlKHtcclxuXHRcdFx0XHRcdHN0YXR1czogJ2d1ZXN0JyxcclxuXHRcdFx0XHRcdHVzZXJuYW1lOiAnJyxcclxuXHRcdFx0XHRcdG9wZW5lZDogZmFsc2VcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG59KTtcclxuXHJcblJlYWN0RE9NLnJlbmRlcihcclxuXHQ8VXNlciAvPixcclxuXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmMtdXNlci1jb250YWluZXInKVxyXG4pO1xyXG4iLCJ2YXIgY3MgPSB7XG5cdGxvZzogZnVuY3Rpb24odGV4dCl7XG5cdFx0Y29uc29sZS5sb2codGV4dCk7XG5cdH0sXG5cdGdldDogZnVuY3Rpb24odXJsLCBzdWNjZXNzKXtcblx0XHR2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cblx0XHR4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoeGhyLnJlYWR5U3RhdGUgPT09IFhNTEh0dHBSZXF1ZXN0LkRPTkUpIHtcblx0XHRcdFx0aWYgKHhoci5zdGF0dXMgPT09IDIwMCkge1xuXHRcdFx0XHRcdHN1Y2Nlc3MoSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKCdhamF4IGdldCBlcnJvcicpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblx0XHR4aHIub3BlbignR0VUJywgdXJsKTtcblx0XHR4aHIuc2VuZCgpO1xuXHR9LFxuXHRwb3N0OiBmdW5jdGlvbih1cmwsIGRhdGEsIHN1Y2Nlc3Mpe1xuXHRcdHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuXHRcdHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcblx0XHRcdGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gWE1MSHR0cFJlcXVlc3QuRE9ORSkge1xuXHRcdFx0XHRpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0c3VjY2VzcyhKU09OLnBhcnNlKHhoci5yZXNwb25zZSkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoJ2FqYXggcG9zdCBlcnJvcicpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblx0XHR4aHIub3BlbignUE9TVCcsIHVybCk7XG5cdFx0eGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0eGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuXHR9LFxuXHRjb29raWU6IGZ1bmN0aW9uKG5hbWUsIGNvb2tpZXMpIHtcblx0XHR2YXIgYyA9IHRoaXMuY29va2llcyhjb29raWVzKTtcblx0XHRyZXR1cm4gY1tuYW1lXTtcblx0fSxcblx0Y29va2llczogZnVuY3Rpb24oY29va2llcykge1xuXHRcdHZhciBuYW1lVmFsdWVzID0gY29va2llcy5zcGxpdCgnOyAnKTtcblx0XHR2YXIgcmVzdWx0ID0ge307XG5cdFx0bmFtZVZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdHZhciBpID0gaXRlbS5zcGxpdCgnPScpO1xuXHRcdFx0cmVzdWx0W2lbMF1dID0gaVsxXTtcblx0XHR9KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRnZXRRdWVyeVZhbHVlOiBmdW5jdGlvbihxdWVyeVN0cmluZywgbmFtZSkge1xuXHRcdHZhciBhcnIgPSBxdWVyeVN0cmluZy5tYXRjaChuZXcgUmVnRXhwKG5hbWUgKyAnPShbXiZdKyknKSk7XG5cblx0XHRpZihhcnIpIHtcblx0XHRcdHJldHVybiBhcnJbMV07XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9XG59O1xuXG52YXIgdGVzdHMgPSBbXG5cdHtcblx0XHRpZDogMSxcblx0XHR0ZXN0OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBjb29raWVzID0ge1xuXHRcdFx0XHRjc2F0aTogJ21ham9tJyxcblx0XHRcdFx0b25lOiAndHdvJ1xuXHRcdFx0fTtcblxuXHRcdFx0dmFyIHJlc3VsdCA9IHRydWU7XG5cblx0XHRcdHZhciBjID0gY3MuY29va2llcygnY3NhdGk9bWFqb207IG9uZT10d28nKTtcblxuXHRcdFx0aWYoYy5jc2F0aSAhPT0gY29va2llcy5jc2F0aSkgcmVzdWx0ID0gZmFsc2U7XG5cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fVxuXHR9LFxuXHR7XG5cdFx0aWQ6IDIsXG5cdFx0dGVzdDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gKCdiYXInID09PSBjcy5jb29raWUoJ2ZvbycsICdmb289YmFyOyB0ZT1tYWpvbScpKTtcblx0XHR9XG5cdH0sXG5cdHtcblx0XHRpZDogMyxcblx0XHR0ZXN0OiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiAnMTIzJyA9PT0gY3MuZ2V0UXVlcnlWYWx1ZSgnP2NzYXRpPW1ham9tJnVzZXJfaWQ9MTIzJnZhbGFtaT1zZW1taScsICd1c2VyX2lkJyk7XG5cdFx0fVxuXHR9XG5dO1xuXG5pZihmYWxzZSkge1xuXHR2YXIgcmVzdWx0ID0gdHJ1ZTtcblx0dGVzdHMuZm9yRWFjaChmdW5jdGlvbih0ZXN0KSB7XG5cdFx0aWYoIXRlc3QudGVzdCgpKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKHRlc3QuaWQgKyAnLiB0ZXN0IGZhaWxlZCcpO1xuXHRcdFx0cmVzdWx0ID0gZmFsc2U7XG5cdFx0fVxuXHR9KTtcblx0aWYocmVzdWx0KSB7XG5cdFx0Y29uc29sZS5sb2coJ0FsbCB0ZXN0cyBzdWNjZWVkZWQhJyk7XG5cdH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjczsiXX0=
